<%
  page = { 'title': 'Social', 'key': 'Social', 'ngApp': 'social' };
  page.description = "FamilySearch Social";
  assets = {
    'css': [ 'index.css', 'bootstrap.css', 'familysearch-styles.styl', 'firechat.css'],
    'js': [
      'angular.min.js',
      'app.js',
      'friendService.js',
      'friendListCtrl.js',
      'userPortrait.js',
      'currentUserService.js',
      'bootstrap.js',
      'inviteFriend.js',
      'sharedPeople.js',
      'removeFriend.js',
      'peopleList.js',
      'getFriends.js',
      'newFriend.js',
      'firebase.js',
      'firechat.js',
      'composeMessage.js',
      'activityFeed.js'
    ]
  };
  partial('partials/_pageGlobals');
%>
<script type="text/javascript">FS.social = <%- JSON.stringify(user) %></script>

<!-- Banner -->
<% if (userId == friendUserId) { %>
<div class="banner">
    <a id="decoration" href="<%- appPath('/') %>"><img class=" user-portrait" user-portrait="" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"></a>
    <% if (userId == friendUserId) { %>
    <div class="user-name"><%= displayName %></div>
    <% } %>
</div>

<!-- Banner Nav -->
<div class="banner-nav-container">
  <div class="banner-nav" data-spy="affix" data-offset-top="260">
    <form class="form-inline pull-left" role="form">
    <div class="input-group">
      <div class="input-group-addon"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></div>
      <input class="form-control search-friends-input" type="text" placeholder="Search Friends" ng-model="searchText.display_name">
    </div>
    </form>
<% if (feature('chatEx')) { %>
    <a href=""><span class="friend-chat glyphicon glyphicon-comment pull-right" title="Chat" aria-hidden="true"></span></a>
<% } %>
    <button class="fs-button fs-button--secondary fs-button--small pull-right invite-btn" invite-friend="">Invite</button>
    <button class="fs-button fs-button--secondary fs-button--small pull-right shared-people">Share</button>
    <button class="fs-button fs-button--secondary fs-button--small pull-right compose-message" compose-message>Compose</button>
    <shared-people data="<%= userId %>"></shared-people>
    <compose-message></compose-message>
  </div>
</div>
<% } %>

<!-- Alert -->
<div class="page-alerts alert alert-warning alert-dismissible fade in" role="alert">
  <button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">Ã—</span><span class="sr-only">Close</span></button>
  <strong>Warning!</strong> This is a FamilySearch prototype, all social data will be deleted throughout the prototyping process.
</div>

<!-- Friend List -->
<section class="friend-list">
  <div class="row">
    <div class="col-md-6">
      <h3 class="friend-list-owner"></h3>
      <div ng-cloak ng-controller="friendListCtrl" model="<%= friendUserId %>">
        <div class="row friend-container" ng-repeat="friend in friends | orderBy: 'display_name' | filter:searchText">
          <a href="{{friend.user_id | cisid: true}}">
            <div class="col-md-2">
              <img class="friend-avatar" ng-src="{{friend.portrait}}">
            </div>
            <!-- <span class="badge badge-info pull-left friends-number" title="Number of friends" get-friends="{{friend.user_id}}">0</span> -->
            <div class="col-md-7 name-container">
              <div class="name">{{friend.display_name}}</div>
            </div>
          </a>

          <% if (userId == friendUserId) { %>
          <div class="col-md-1 btn-group remove-btn">
            <a class="fs-button fs-button--small fs-button--secondary dropdown-toggle" data-toggle="dropdown" href="#">Actions <span class="caret"></span></a>
            <ul class="dropdown-menu">
              <li><a href="" class="remove-btn" remove-friend="{{friend.user_id}}" data-handle="{{friend.display_name}}">Remove Friend</a></li>
              <li><a href="mailto:{{friend.email}}" class="remove-btn" target="_blank">Send Email</a></li>
            </ul>
          </div>
          <% } %>

        </div>
      </div>
    </div>

    <div class="col-md-6">
      <h3 class="shared-people-heading">Shared Memory People</h3>
      <div class="peoplelist-component" people-list="<%= friendUserId %>"></div>
    </div>
    
    <div>
      <!-- <h3>Activity Feed</h3> -->
      <div class="activity-feed" activity-feed="<%= friendUserId %>"></div>
    </div>
  </div>
</section>

<!-- Show modal when accepting new friend requests -->
<% if (newFriendName) { %>
  <new-friend data-name="<%= newFriendName %>" data-id="<%= userId.split(".")[2] %>">
<% } %>

<!-- Firechat -->
<% if (feature('chatEx')) { %>
<script type='text/javascript'>
  $( document ).ready(function() {
    var firechatRef = new Firebase('https://luminous-torch-8189.firebaseio.com/chat');
    firechatRef.authWithCustomToken("<%= firechatToken %>", function(error, authData) {
      if (error) return console.log(error);
      if (authData) {
        var chat = new FirechatUI(firechatRef, document.getElementById('firechat-wrapper'));
        chat.setUser(authData.uid, authData.auth.name);
      }
    });
  });
  $('.hide-chat, .friend-chat').on('click', function(event) {
    $('.chat-container').toggle();
  });
</script>
<div class="chat-container">
  <div id='firechat-wrapper'></div>
</div>
<% } %>